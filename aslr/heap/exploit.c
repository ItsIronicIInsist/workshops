#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>

int getUserInput();
void menu();
void allocate();
void delete();
void view();
int findFreeIdx();
void allocatePointers();

unsigned long * chunks[0x10];

int main() {
	while (true) {
		menu();
		
		int choice = getUserInput();
		switch(choice) {
			case 1:
				allocate();
				break;
			case 2:
				delete();
				break;
			case 3:
				view();
				break;
			case 4:
				allocatePointers();
				break;
			default:
				puts("Invalid choice.");
				break;
		}
	}
}

int getUserInput() {
	char buf[0x10];

	fgets(buf, 0xf, stdin);
	return atoi(buf);
}

void menu() {
	puts("1. Allocate");
	puts("2. Delete");
	puts("3. View");
	puts("4. Allocate pointers");
}

void allocate() {
	puts("What size?");
	int size = getUserInput();

	unsigned long * chunk = malloc(size);

	int nextFreeIndex = findFreeIdx();
	if (nextFreeIndex == -1)
		puts("No remaining spaces in table");

	chunks[nextFreeIndex] = chunk;
}

void delete() {
	puts("What index?");
	int idx = getUserInput();

	free(chunks[idx]);
}

void view() {
	puts("What index?");
	int idx = getUserInput();

	puts("How many qwords?");
	int len = getUserInput();

	for(int i = 0 ; i < len ; i++) {
		printf("%p\n", chunks[idx][i]);
	}

}

int findFreeIdx() {
	for (int i = 0 ; i < 0x10 ; i++) {
		if (chunks[i] == NULL) {
			return i;
		}
	}
	return -1;
}

// Pretend this is a struct
void allocatePointers() {
	unsigned long * chunk = malloc(0x10);

	chunk[0] = puts;
	chunk[1] = chunk;

	int nextFreeIndex = findFreeIdx();
	if (nextFreeIndex == -1)
		puts("No remaining spaces in table");

	chunks[nextFreeIndex] = chunk;
}
